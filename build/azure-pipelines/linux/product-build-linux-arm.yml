steps:
- script: docker run --rm --privileged multiarch/qemu-user-static:register --reset
  displayName: 'Register Docker QEMU'

# - task: NodeTool@0
#   inputs:
#     versionSpec: "10.15.1"

# - task: geeklearningio.gl-vsts-tasks-yarn.yarn-installer-task.YarnInstaller@2
#   inputs:
#     versionSpec: "1.10.1"

- task: Docker@0
  displayName: Build
  inputs:
    containerregistrytype: 'Container Registry'
    dockerRegistryConnection: VSCodeHub
    action: 'Run an image'
    imageName: 'vscode-linux-build-agent:armhf'
    volumes: |
      $(Build.SourcesDirectory):/src
    envVars: |
      VSO_PAT=$(VSO_PAT)
      VSCODE_MIXIN_REPO=$(VSCODE_MIXIN_REPO)
      VSCODE_MIXIN_PASSWORD=$(VSCODE_MIXIN_PASSWORD)
    containerCommand: '/src/build/azure-pipelines/linux/build-arm.sh'
    workDir: '/src'
    detached: false
